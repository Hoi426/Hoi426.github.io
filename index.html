<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Hệ thống Thi Online Nâng Cao</title>
    <style>
        :root { --primary: #2c3e50; --success: #27ae60; --danger: #e74c3c; --bg: #f4f7f6; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: var(--bg); padding: 20px; line-height: 1.6; }
        .container { max-width: 900px; margin: auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        
        /* Tên đề thi */
        .exam-header { text-align: center; margin-bottom: 30px; padding-bottom: 15px; border-bottom: 3px double var(--primary); }
        .exam-title-label { font-size: 28px; font-weight: bold; color: var(--primary); }

        /* 3 Hình chữ nhật menu */
        .menu-grid { display: flex; flex-direction: column; gap: 20px; }
        .section-card { 
            background: #fff; border: 2px solid var(--primary); border-radius: 10px; 
            padding: 40px; text-align: center; cursor: pointer; transition: 0.3s;
            font-size: 22px; font-weight: bold; color: var(--primary);
        }
        .section-card:hover { background: var(--primary); color: white; transform: scale(1.02); }

        /* Câu hỏi và Đáp án */
        .question-item { margin-bottom: 30px; padding: 20px; border: 1px solid #eee; border-radius: 8px; }
        .status-tag { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 12px; margin-bottom: 10px; font-weight: bold; }
        .tag-correct { background: #d4edda; color: #155724; }
        .tag-wrong { background: #f8d7da; color: #721c24; }
        
        .ans-option { padding: 8px; margin: 5px 0; border-radius: 5px; border: 1px solid #ddd; }
        .correct-highlight { background: #c8e6c9 !important; border-color: #4caf50; }
        .wrong-highlight { background: #ffcdd2 !important; border-color: #f44336; }

        /* Nút bấm */
        .btn-group { margin-top: 20px; display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; }
        .btn { padding: 12px 25px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .btn-main { background: var(--primary); color: white; }
        .btn-view { background: #3498db; color: white; }
        .btn-back { background: #95a5a6; color: white; }

        #result-area { display: none; text-align: center; }
        .final-score { font-size: 50px; color: #e67e22; margin: 20px 0; }
    </style>
</head>
<body>

<div class="container">
    <div id="setup-view">
        <div class="exam-header">
            <div class="exam-title-label">[Tên đề thi]: BÀI KIỂM TRA ĐỊNH KỲ</div>
        </div>
        <div class="menu-grid">
            <div class="section-card" onclick="initQuiz('choice')">Trắc nghiệm 4 lựa chọn</div>
            <div class="section-card" onclick="initQuiz('tf')">Đúng/Sai</div>
            <div class="section-card" onclick="initQuiz('short')">Trả lời ngắn</div>
        </div>
    </div>

    <div id="quiz-view" style="display:none;">
        <h2 id="quiz-type-title"></h2>
        <div id="questions-container"></div>
        <div class="btn-group">
            <button class="btn btn-main" onclick="processGrading()">Nộp bài và xem điểm</button>
        </div>
    </div>

    <div id="result-area">
        <h2>Kết quả bài làm</h2>
        <div class="final-score" id="display-score">0/10</div>
        <div class="btn-group">
            <button class="btn btn-view" onclick="renderReview('correct')">Coi đáp án đúng</button>
            <button class="btn btn-view" onclick="renderReview('wrong')">Coi đáp án sai</button>
            <button class="btn btn-view" onclick="renderReview('all')">Coi toàn bộ theo đề gốc</button>
        </div>
        <div id="review-content" style="margin-top: 30px; text-align: left;"></div>
        <button class="btn btn-back" onclick="location.reload()" style="margin-top: 20px;">Quay lại trang chủ</button>
    </div>
</div>

<script>
// Dữ liệu gốc (Giáo viên nhập vào đây)
const rawData = {
    choice: [
        { id: 1, q: "Hành tinh nào gần Mặt trời nhất?", options: ["Kim tinh", "Thủy tinh", "Hỏa tinh", "Trái đất"], correct: 1 },
        { id: 2, q: "Đơn vị đo cường độ dòng điện là?", options: ["Vôn", "Oát", "Ampe", "Ôm"], correct: 2 }
    ],
    tf: [
        { 
            id: 3, q: "Các phát biểu sau về orbital (obitan) nguyên tử:", 
            sub: [
                { t: "Orbital s có dạng hình cầu", a: true },
                { t: "Mỗi orbital chứa tối đa 3 electron", a: false },
                { t: "Orbital p có dạng hình số 8 nổi", a: true },
                { t: "Lớp K chỉ có 1 orbital", a: true }
            ] 
        }
    ],
    short: [
        { id: 4, q: "Căn bậc hai của 64 là bao nhiêu?", correct: "8" }
    ]
};

let currentQuestions = [];
let userResponses = {};
let activeCategory = '';

function initQuiz(type) {
    if (!rawData[type] || rawData[type].length === 0) {
        alert("Không có câu hỏi"); return;
    }
    activeCategory = type;
    // Copy và xáo trộn để làm bài
    currentQuestions = [...rawData[type]].sort(() => Math.random() - 0.5);
    
    document.getElementById('setup-view').style.display = 'none';
    document.getElementById('quiz-view').style.display = 'block';
    renderExam();
}

function renderExam() {
    const container = document.getElementById('questions-container');
    container.innerHTML = '';
    
    currentQuestions.forEach((item, index) => {
        let html = `<div class="question-item"><p><b>Câu ${index+1}:</b> ${item.q}</p>`;
        
        if (activeCategory === 'choice') {
            item.options.forEach((opt, i) => {
                html += `<div class="ans-option"><input type="radio" name="q${item.id}" value="${i}"> ${opt}</div>`;
            });
        } else if (activeCategory === 'tf') {
            item.sub.forEach((s, i) => {
                html += `<div style="margin-left:20px; margin-bottom:10px;">• ${s.t}: 
                    <input type="radio" name="q${item.id}_${i}" value="true"> Đ 
                    <input type="radio" name="q${item.id}_${i}" value="false"> S</div>`;
            });
        } else if (activeCategory === 'short') {
            html += `<input type="text" class="btn" style="border:1px solid #ccc" id="short_${item.id}" placeholder="Điền đáp án số...">`;
        }
        
        container.innerHTML += html + `</div>`;
    });
}

function processGrading() {
    let rawScore = 0;
    const pointsPerQuest = 10 / currentQuestions.length;

    currentQuestions.forEach(item => {
        userResponses[item.id] = { points: 0, details: [] };
        
        if (activeCategory === 'choice') {
            const selected = document.querySelector(`input[name="q${item.id}"]:checked`);
            const val = selected ? parseInt(selected.value) : null;
            userResponses[item.id].selected = val;
            if (val === item.correct) {
                userResponses[item.id].points = pointsPerQuest;
            }
        } 
        else if (activeCategory === 'tf') {
            let subCorrect = 0;
            item.sub.forEach((s, i) => {
                const sel = document.querySelector(`input[name="q${item.id}_${i}"]:checked`);
                const userVal = sel ? (sel.value === 'true') : null;
                userResponses[item.id].details.push(userVal);
                if (userVal === s.a) subCorrect++;
            });
            
            // Logic điểm đặc biệt 1/10, 2/10, 5/10, 10/10
