<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Hệ thống Thi Online</title>
    <style>
        :root { --primary: #2c3e50; --bg: #f4f7f6; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); padding: 20px; color: #333; }
        .container { max-width: 800px; margin: auto; }
        
        /* Tên đề thi */
        .exam-title { text-align: center; color: var(--primary); font-size: 24px; font-weight: bold; margin-bottom: 30px; border-bottom: 2px solid var(--primary); padding-bottom: 10px; }

        /* 3 Hình chữ nhật chính */
        .section-box { 
            background: white; border: 2px solid var(--primary); border-radius: 12px; 
            padding: 30px; margin-bottom: 20px; text-align: center; 
            cursor: pointer; transition: 0.3s; font-size: 20px; font-weight: bold;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .section-box:hover { background: #ecf0f1; transform: translateY(-5px); }

        /* Vùng làm bài */
        #quiz-container { display: none; background: white; padding: 20px; border-radius: 12px; }
        .question { margin-bottom: 25px; padding-bottom: 15px; border-bottom: 1px solid #ddd; }
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        
        /* Nút chức năng */
        .btn { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; margin: 5px; }
        .btn-submit { background: #27ae60; color: white; }
        .btn-review { background: #3498db; color: white; }

        /* Kết quả */
        #result-screen { display: none; text-align: center; background: white; padding: 40px; border-radius: 12px; }
        .score-display { font-size: 48px; color: #e67e22; }
    </style>
</head>
<body>

<div class="container">
    <div class="exam-title">[Tên đề thi]: KIỂM TRA TỔNG HỢP</div>

    <div id="main-menu">
        <div class="section-box" onclick="startQuiz('multiple_choice')">Trắc nghiệm 4 lựa chọn</div>
        <div class="section-box" onclick="startQuiz('true_false')">Đúng/Sai</div>
        <div class="section-box" onclick="startQuiz('short_answer')">Trả lời ngắn</div>
    </div>

    <div id="quiz-container">
        <div id="questions-list"></div>
        <button class="btn btn-submit" onclick="submitExam()">Nộp bài</button>
    </div>

    <div id="result-screen">
        <h2>Kết quả của bạn</h2>
        <div class="score-display" id="final-score">0/10</div>
        <div id="review-buttons">
            <button class="btn btn-review" onclick="filterResults('correct')">Coi đáp án đúng</button>
            <button class="btn btn-review" onclick="filterResults('wrong')">Coi đáp án sai</button>
            <button class="btn btn-review" onclick="filterResults('all')">Coi toàn bộ theo đề gốc</button>
        </div>
        <div id="history-log" style="margin-top: 20px; font-size: 0.9em; color: #666;"></div>
    </div>
</div>

<script>
/* DỮ LIỆU MẪU (Giáo viên sẽ nhập hàng loạt vào đây) */
const database = {
    multiple_choice: [
        { q: "Thủ đô của Việt Nam là gì?", options: ["Hà Nội", "Hồ Chí Minh", "Đà Nẵng", "Cần Thơ"], correct: 0 },
        { q: "2 + 2 bằng mấy?", options: ["3", "4", "5", "6"], correct: 1 }
    ],
    true_false: [
        { 
            q: "Chọn Đúng/Sai cho các phát biểu về Trái Đất:", 
            sub: [
                { text: "Trái đất hình vuông", correct: false },
                { text: "Trái đất quay quanh Mặt trời", correct: true },
                { text: "Mặt trăng là vệ tinh của Trái đất", correct: true },
                { text: "Nước chiếm 1% bề mặt Trái đất", correct: false }
            ] 
        }
    ],
    short_answer: [] // Để trống để thử thông báo "Không có câu hỏi"
};

let currentType = '';
let userAnswers = [];

// Khởi tạo bài thi
function startQuiz(type) {
    if (database[type].length === 0) {
        alert("Không có câu hỏi");
        return;
    }
    currentType = type;
    document.getElementById('main-menu').style.display = 'none';
    document.getElementById('quiz-container').style.display = 'block';
    renderQuestions(type);
}

// Render câu hỏi (Tự động Shuffle)
function renderQuestions(type) {
    const list = document.getElementById('questions-list');
    list.innerHTML = '';
    let questions = [...database[type]];
    
    // Shuffle câu hỏi
    questions.sort(() => Math.random() - 0.5);

    questions.forEach((item, idx) => {
        let html = `<div class="question"><p><b>Câu ${idx+1}:</b> ${item.q}</p>`;
        
        if (type === 'multiple_choice') {
            item.options.forEach((opt, oIdx) => {
                html += `<label><input type="radio" name="q${idx}" value="${oIdx}"> ${opt}</label><br>`;
            });
        } else if (type === 'true_false') {
            item.sub.forEach((s, sIdx) => {
                html += `<div style="margin-left:20px;">${s.text}: 
                    <input type="radio" name="q${idx}s${sIdx}" value="true"> Đ 
                    <input type="radio" name="q${idx}s${sIdx}" value="false"> S</div>`;
            });
        } else if (type === 'short_answer') {
            html += `<input type="number" name="q${idx}" step="any">`;
        }
        
        html += `</div>`;
        list.innerHTML += html;
    });
}

// Tính điểm theo logic yêu cầu
function submitExam() {
    const questions = database[currentType];
    let totalPoints = 0;
    const pointsPerQuestion = 10 / questions.length;

    questions.forEach((item, idx) => {
        if (currentType === 'multiple_choice') {
            const selected = document.querySelector(`input[name="q${idx}"]:checked`);
            if (selected && parseInt(selected.value) === item.correct) totalPoints += pointsPerQuestion;
        } 
        else if (currentType === 'true_false') {
            let correctSubCount = 0;
            item.sub.forEach((s, sIdx) => {
                const sel = document.querySelector(`input[name="q${idx}s${sIdx}"]:checked`);
                if (sel && (sel.value === 'true') === s.correct) correctSubCount++;
            });
            // Công thức 1/10, 2/10, 5/10, 10/10
            if (correctSubCount === 1) totalPoints += (pointsPerQuestion * 0.1);
            else if (correctSubCount === 2) totalPoints += (pointsPerQuestion * 0.2);
            else if (correctSubCount === 3) totalPoints += (pointsPerQuestion * 0.5);
            else if (correctSubCount === 4) totalPoints += pointsPerQuestion;
        }
    });

    const finalScore = Math.round(totalPoints * 10) / 10;
    showResult(finalScore);
}

function showResult(score) {
    document.getElementById('quiz-container').style.display = 'none';
    document.getElementById('result-screen').style.display = 'block';
    document.getElementById('final-score').innerText = `${score}/10`;
    
    // Lưu LocalStorage
    let history = JSON.parse(localStorage.getItem('exam_history') || "[]");
    history.push({ type: currentType, score: score, date: new Date().toLocaleString() });
    localStorage.setItem('exam_history', JSON.stringify(history));
    
    renderHistory();
}

function renderHistory() {
    let history = JSON.parse(localStorage.getItem('exam_history') || "[]");
    let html = "<b>Lịch sử làm bài:</b><br>";
    history.forEach(h => html += `- Dạng: ${h.type}, Điểm: ${h.score}, Lúc: ${h.date}<br>`);
    document.getElementById('history-log').innerHTML = html;
}

// Chức năng xem lại đáp án (Mô phỏng)
function filterResults(mode) {
    alert("Tính năng đang hiển thị theo chế độ: " + mode);
}
</script>
</body>
</html>